{% extends "layout.html" %}
{% block title %}Pricing - NewWhale Career{% endblock %}
{% block content %}
<div class="row mb-4 mt-2">
    <div class="col-md-12 text-center">
        <h1>Choose Your Plan</h1>
        <p class="lead text-muted">Unlock the full power of AI-assisted career development</p>
    </div>
</div>

<div class="row justify-content-center g-4">
    <div class="col-md-4">
        <div class="card h-100 {% if current_user.is_authenticated and current_user.tier == 'free' %}border-primary{% endif %}">
            <div class="card-header text-center">
                <h3 style="margin-bottom: 0.25rem;">Free</h3>
                <h2 class="display-4">$0</h2>
                <p class="text-muted mb-0">Perfect for getting started</p>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Job listings access</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> 3 resume assessments/day</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Basic AI analysis</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Industry compatibility scores</li>
                    <li class="mb-2 text-muted"><i class="bi bi-x-circle"></i> Resume revision</li>
                    <li class="mb-2 text-muted"><i class="bi bi-x-circle"></i> Unlimited assessments</li>
                    <li class="mb-2 text-muted"><i class="bi bi-x-circle"></i> Priority support</li>
                </ul>
            </div>
            <div class="card-footer text-center">
                {% if current_user.is_authenticated and current_user.tier == 'free' %}
                <button class="btn btn-secondary" disabled>Current Plan</button>
                {% elif current_user.is_authenticated %}
                <button class="btn btn-outline-secondary" disabled>Your Tier: Premium</button>
                {% else %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-outline-primary">Sign Up Free</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100 shadow-lg" style="border: 2px solid var(--nw-blue); transform: scale(1.02);">
            <div class="card-header text-center" style="background: var(--nw-blue) !important; color: white !important;">
                <span class="badge" style="background-color: var(--nw-accent) !important; color: var(--nw-navy) !important; margin-bottom: 0.5rem;">MOST POPULAR</span>
                <h3 style="color: white !important; margin-bottom: 0.25rem;">Premium Monthly</h3>
                <h2 class="display-4" style="color: white !important;">$30</h2>
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 0;">per month</p>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Everything in Free</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> <strong>Unlimited assessments</strong></li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> <strong>AI-powered resume revision</strong></li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Template-based suggestions</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Before/after comparisons</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Priority support</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Advanced analytics</li>
                </ul>
            </div>
            <div class="card-footer text-center">
                {% if current_user.is_authenticated and current_user.is_premium() %}
                <button class="btn btn-success" disabled><i class="bi bi-check-circle"></i> Current Plan</button>
                {% elif current_user.is_authenticated %}
                <button class="btn btn-primary btn-lg subscribe-btn" onclick="subscribe('monthly')">
                    <i class="bi bi-credit-card"></i> Subscribe Monthly
                </button>
                {% else %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-person-plus"></i> Sign Up to Subscribe
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header text-center" style="background: var(--nw-navy) !important; color: white !important;">
                <span class="badge" style="background-color: #27ae60 !important; color: white !important; margin-bottom: 0.5rem;">BEST VALUE</span>
                <h3 style="color: white !important; margin-bottom: 0.25rem;">Premium Annual</h3>
                <h2 class="display-4" style="color: white !important;">$252</h2>
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 0;">per year</p>
                <small style="color: #27ae60;">Save $108 (30% off)</small>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Everything in Premium Monthly</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> <strong>2 months FREE</strong></li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> <strong>Cold Email Outreach</strong></li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Open & reply tracking</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> Early access to features</li>
                </ul>
            </div>
            <div class="card-footer text-center">
                {% if current_user.is_authenticated and current_user.is_premium() %}
                <button class="btn btn-success" disabled><i class="bi bi-check-circle"></i> Premium Member</button>
                {% elif current_user.is_authenticated %}
                <button class="btn btn-primary btn-lg subscribe-btn" onclick="subscribe('annual')">
                    <i class="bi bi-credit-card"></i> Subscribe Annually
                </button>
                {% else %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-person-plus"></i> Sign Up to Subscribe
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-body">
                <h4><i class="bi bi-question-circle"></i> Frequently Asked Questions</h4>
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                What's included in the resume assessment?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Our AI analyzes your resume and provides: overall competitiveness score (0-100), specific strengths and weaknesses, industry compatibility ratings for 5 AI-proof finance sectors, and actionable recommendations for improvement.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                What's the difference between assessment and revision?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <strong>Assessment (Free):</strong> Analyzes your current resume and gives you scores and feedback.<br>
                                <strong>Revision (Premium):</strong> Compares your resume against successful templates from top finance firms and provides specific section-by-section rewrite suggestions.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                Can I cancel anytime?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Yes! You can cancel your subscription at any time. You'll retain access until the end of your billing period.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function subscribe(plan) {
    var buttons = document.querySelectorAll('.subscribe-btn');
    buttons.forEach(function(btn) {
        btn.disabled = true;
    });

    var clickedBtn = event.target.closest('.subscribe-btn');
    if (clickedBtn) {
        clickedBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Redirecting to checkout...';
    }

    fetch('/api/checkout', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token() }}'
        },
        body: JSON.stringify({ plan: plan })
    })
    .then(function(response) { return response.json(); })
    .then(function(data) {
        if (data.success && data.checkout_url) {
            window.location.href = data.checkout_url;
        } else {
            alert(data.message || 'Error creating checkout session. Please try again.');
            buttons.forEach(function(btn) { btn.disabled = false; });
            if (clickedBtn) {
                clickedBtn.innerHTML = plan === 'monthly'
                    ? '<i class="bi bi-credit-card"></i> Subscribe Monthly'
                    : '<i class="bi bi-credit-card"></i> Subscribe Annually';
            }
        }
    })
    .catch(function(error) {
        alert('Connection error. Please try again.');
        buttons.forEach(function(btn) { btn.disabled = false; });
        if (clickedBtn) {
            clickedBtn.innerHTML = plan === 'monthly'
                ? '<i class="bi bi-credit-card"></i> Subscribe Monthly'
                : '<i class="bi bi-credit-card"></i> Subscribe Annually';
        }
    });
}
</script>
{% endblock %}
